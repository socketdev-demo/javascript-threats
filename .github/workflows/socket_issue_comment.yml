name: socket-security-issue-comment
run-name: Socket Security Github Action
on:
  issue_comment:
    types: [created, edited]
jobs:
  socket-security-comment:
    permissions:
      issues: write
      contents: read
      pull-requests: write
    runs-on: ubuntu-latest
    if: ${{ github.event.issue.pull_request}}
    steps:
      - name: Check PR Issue Comment
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          
        run: |
          COMMENT_BODY=${{ github.event.comment.body }}
          COMMENT_STR=${COMMENT_BODY//$'\n'/\\n}
          echo "${{ github.event.comment.body }}" | grep -q "SocketSecurity ignore"
          if [ $? -eq 0 ]; then
            curl -X POST -H 'Content-Type: application/json' --data '[{"type": "section", "text" {"type": "mkrdwn", "text": "**${{ github.event.comment.user.email }}** commented $COMMENT_STR on ${{ github.event.issue.pull_request.issue_url}}"}]' $SLACK_WEBHOOK
          fi
          
